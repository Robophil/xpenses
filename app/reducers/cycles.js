"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _ = require("lodash");
var cycles_action_1 = require("../actions/cycles.action");
var initialState = {
    selected: '',
    count: 0,
    date: new Date,
    status: false,
    ids: [],
    data: null,
};
function cycle(state, _a) {
    var type = _a.type, payload = _a.payload;
    switch (type) {
        case cycles_action_1.CyclesActions.ADD_CATEGORY_COMPLETE: {
            var categories = [payload].concat(state.categories);
            return Object.assign({}, state, { categories: categories });
        }
    }
}
exports.cycle = cycle;
// Reducer
function cycles(state, _a) {
    if (state === void 0) { state = initialState; }
    var type = _a.type, payload = _a.payload;
    switch (type) {
        case cycles_action_1.CyclesActions.SELECT: { }
        case cycles_action_1.CyclesActions.ADD_CATEGORY_COMPLETE: {
            var selected = state.data[payload.id];
            var update = cycle(selected, { type: cycles_action_1.CyclesActions.ADD_CATEGORY_COMPLETE, payload: payload.category });
            var data = Object.assign({}, state.data, (_b = {}, _b[payload.id] = update, _b));
            return Object.assign({}, state, { data: data });
        }
        case cycles_action_1.CyclesActions.CREATE_COMPLETE: {
            var data = Object.assign({}, state.data, (_c = {}, _c[payload.id] = payload, _c));
            var ids = [payload.id].concat(state.ids);
            return Object.assign({}, state, { date: payload.date, selected: payload.id, status: true, ids: ids, data: data });
        }
        case cycles_action_1.CyclesActions.INIT_COMPLETE: {
            var ids = payload.map(function (data) { return data.id; });
            var data = _.mapKeys(payload, 'id');
            return Object.assign({}, state, { status: false, count: ids.length, ids: ids, data: data });
        }
        default: return state;
    }
    var _b, _c;
}
exports.cycles = cycles;
;
// Selectors
function getIds() {
    return function (diary$) { return diary$.map(function (t) { return t.ids; }).filter(function (ids) { return !!ids; }); };
}
exports.getIds = getIds;
function getData(ids) {
    return function (diary$) { return diary$
        .map(function (t) { return t.data; })
        .filter(function (data) { return data !== null; })
        .map(function (data) { return ids.map(function (id) { return data[id]; }); }); };
}
exports.getData = getData;
function getSelectedId() {
    return function (diary$) { return diary$.map(function (t) { return t.selected; }).filter(function (s) { return !!s.length; }); };
}
exports.getSelectedId = getSelectedId;
function getSelectedDate() {
    return function (diary$) { return diary$.map(function (t) { return t.date; }); };
}
exports.getSelectedDate = getSelectedDate;
function getSelected() {
    return function (diary$) { return diary$.filter(function (s) { return !!s.ids.length; }).map(function (t) { return t.data[t.selected]; }); };
}
exports.getSelected = getSelected;
function getCount() {
    return function (diary$) { return diary$.map(function (t) { return t.count; }); };
}
exports.getCount = getCount;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3ljbGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY3ljbGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsMEJBQTRCO0FBRzVCLDBEQUF5RDtBQVl6RCxJQUFNLFlBQVksR0FBZ0I7SUFDaEMsUUFBUSxFQUFFLEVBQUU7SUFDWixLQUFLLEVBQUUsQ0FBQztJQUNSLElBQUksRUFBRSxJQUFJLElBQUk7SUFDZCxNQUFNLEVBQUUsS0FBSztJQUNiLEdBQUcsRUFBRSxFQUFFO0lBQ1AsSUFBSSxFQUFFLElBQUk7Q0FDWCxDQUFBO0FBRUQsZUFBc0IsS0FBa0IsRUFBRSxFQUF5QjtRQUF2QixjQUFJLEVBQUUsb0JBQU87SUFDdkQsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNiLEtBQUssNkJBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ3pDLElBQU0sVUFBVSxJQUFJLE9BQU8sU0FBSyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLFVBQVUsWUFBQSxFQUFFLENBQUMsQ0FBQztRQUNsRCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUM7QUFQRCxzQkFPQztBQUVELFVBQVU7QUFDVixnQkFBdUIsS0FBaUMsRUFBRSxFQUF5QjtJQUE1RCxzQkFBQSxFQUFBLG9CQUFpQztRQUFJLGNBQUksRUFBRSxvQkFBTztJQUN2RSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2IsS0FBSyw2QkFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUU5QixLQUFLLDZCQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUN6QyxJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN4QyxJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLDZCQUFhLENBQUMscUJBQXFCLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3pHLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxJQUFJLFlBQUksR0FBQyxPQUFPLENBQUMsRUFBRSxJQUFHLE1BQU0sTUFBRyxDQUFDO1lBRXJFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDLENBQUM7UUFDNUMsQ0FBQztRQUVELEtBQUssNkJBQWEsQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNuQyxJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxZQUFJLEdBQUMsT0FBTyxDQUFDLEVBQUUsSUFBRyxPQUFPLE1BQUcsQ0FBQztZQUN0RSxJQUFNLEdBQUcsSUFBSSxPQUFPLENBQUMsRUFBRSxTQUFLLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEtBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDLENBQUM7UUFDekcsQ0FBQztRQUVELEtBQUssNkJBQWEsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNqQyxJQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEVBQUUsRUFBUCxDQUFPLENBQUMsQ0FBQztZQUN6QyxJQUFNLElBQUksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQWUsQ0FBQztZQUVwRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLEtBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDLENBQUM7UUFDbkYsQ0FBQztRQUVELFNBQVMsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUN4QixDQUFDOztBQUNILENBQUM7QUEzQkQsd0JBMkJDO0FBQUEsQ0FBQztBQUdGLFlBQVk7QUFDWjtJQUNFLE1BQU0sQ0FBQyxVQUFDLE1BQStCLElBQUssT0FBQSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEdBQUcsRUFBTCxDQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxDQUFDLENBQUMsR0FBRyxFQUFMLENBQUssQ0FBQyxFQUEzQyxDQUEyQyxDQUFDO0FBQzFGLENBQUM7QUFGRCx3QkFFQztBQUNELGlCQUF3QixHQUFHO0lBQ3pCLE1BQU0sQ0FBQyxVQUFDLE1BQStCLElBQUssT0FBQSxNQUFNO1NBQy9DLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDO1NBQ2hCLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksS0FBSyxJQUFJLEVBQWIsQ0FBYSxDQUFDO1NBQzdCLEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBQSxFQUFFLElBQUksT0FBQSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQVIsQ0FBUSxDQUFDLEVBQXZCLENBQXVCLENBQUMsRUFISyxDQUdMLENBQUM7QUFDMUMsQ0FBQztBQUxELDBCQUtDO0FBQ0Q7SUFDRSxNQUFNLENBQUMsVUFBQyxNQUErQixJQUFLLE9BQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxRQUFRLEVBQVYsQ0FBVSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQVYsQ0FBVSxDQUFDLEVBQW5ELENBQW1ELENBQUM7QUFDbEcsQ0FBQztBQUZELHNDQUVDO0FBQ0Q7SUFDRSxNQUFNLENBQUMsVUFBQyxNQUErQixJQUFLLE9BQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDLEVBQXZCLENBQXVCLENBQUM7QUFDdEUsQ0FBQztBQUZELDBDQUVDO0FBQ0Q7SUFDRSxNQUFNLENBQUMsVUFBQyxNQUErQixJQUFLLE9BQUEsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBZCxDQUFjLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBbEIsQ0FBa0IsQ0FBQyxFQUEvRCxDQUErRCxDQUFDO0FBQzlHLENBQUM7QUFGRCxrQ0FFQztBQUNEO0lBQ0UsTUFBTSxDQUFDLFVBQUMsTUFBK0IsSUFBSyxPQUFBLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxFQUFQLENBQU8sQ0FBQyxFQUF4QixDQUF3QixDQUFDO0FBQ3ZFLENBQUM7QUFGRCw0QkFFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xuaW1wb3J0IHsgU3RvcmUsIEFjdGlvbiB9IGZyb20gJ0BuZ3J4L3N0b3JlJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgQ3ljbGVzTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvY3ljbGUubW9kZWwnO1xuaW1wb3J0IHsgQ3ljbGVzQWN0aW9ucyB9IGZyb20gJy4uL2FjdGlvbnMvY3ljbGVzLmFjdGlvbic7XG5cbmV4cG9ydCB0eXBlIEN5Y2xlc0RhdGEgPSB7IFtpZDogbnVtYmVyXTogQ3ljbGVzTW9kZWwgfTtcbmV4cG9ydCBpbnRlcmZhY2UgQ3ljbGVzU3RhdGUge1xuICBzZWxlY3RlZDogc3RyaW5nO1xuICBkYXRlOiBEYXRlO1xuICBzdGF0dXM6IGJvb2xlYW47XG4gIGlkczogbnVtYmVyW107XG4gIGRhdGE6IEN5Y2xlc0RhdGE7XG4gIGNvdW50OiBudW1iZXI7XG59XG5cbmNvbnN0IGluaXRpYWxTdGF0ZTogQ3ljbGVzU3RhdGUgPSB7XG4gIHNlbGVjdGVkOiAnJyxcbiAgY291bnQ6IDAsXG4gIGRhdGU6IG5ldyBEYXRlLFxuICBzdGF0dXM6IGZhbHNlLFxuICBpZHM6IFtdLFxuICBkYXRhOiBudWxsLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3ljbGUoc3RhdGU6IEN5Y2xlc01vZGVsLCB7IHR5cGUsIHBheWxvYWQgfTogQWN0aW9uKTogQ3ljbGVzTW9kZWwge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIEN5Y2xlc0FjdGlvbnMuQUREX0NBVEVHT1JZX0NPTVBMRVRFOiB7XG4gICAgICBjb25zdCBjYXRlZ29yaWVzID0gW3BheWxvYWQsIC4uLnN0YXRlLmNhdGVnb3JpZXNdO1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLCB7IGNhdGVnb3JpZXMgfSk7XG4gICAgfVxuICB9XG59XG5cbi8vIFJlZHVjZXJcbmV4cG9ydCBmdW5jdGlvbiBjeWNsZXMoc3RhdGU6IEN5Y2xlc1N0YXRlID0gaW5pdGlhbFN0YXRlLCB7IHR5cGUsIHBheWxvYWQgfTogQWN0aW9uKTogQ3ljbGVzU3RhdGUge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIEN5Y2xlc0FjdGlvbnMuU0VMRUNUOiB7IH1cblxuICAgIGNhc2UgQ3ljbGVzQWN0aW9ucy5BRERfQ0FURUdPUllfQ09NUExFVEU6IHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0gc3RhdGUuZGF0YVtwYXlsb2FkLmlkXTtcbiAgICAgIGNvbnN0IHVwZGF0ZSA9IGN5Y2xlKHNlbGVjdGVkLCB7IHR5cGU6IEN5Y2xlc0FjdGlvbnMuQUREX0NBVEVHT1JZX0NPTVBMRVRFLCBwYXlsb2FkOiBwYXlsb2FkLmNhdGVnb3J5IH0pO1xuICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLmRhdGEsIHsgW3BheWxvYWQuaWRdOiB1cGRhdGUgfSk7XG5cbiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZSwgeyBkYXRhIH0pO1xuICAgIH1cblxuICAgIGNhc2UgQ3ljbGVzQWN0aW9ucy5DUkVBVEVfQ09NUExFVEU6IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBzdGF0ZS5kYXRhLCB7IFtwYXlsb2FkLmlkXTogcGF5bG9hZCB9KTtcbiAgICAgIGNvbnN0IGlkcyA9IFtwYXlsb2FkLmlkLCAuLi5zdGF0ZS5pZHNdO1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHN0YXRlLCB7IGRhdGU6IHBheWxvYWQuZGF0ZSwgc2VsZWN0ZWQ6IHBheWxvYWQuaWQsIHN0YXR1czogdHJ1ZSwgaWRzLCBkYXRhIH0pO1xuICAgIH1cblxuICAgIGNhc2UgQ3ljbGVzQWN0aW9ucy5JTklUX0NPTVBMRVRFOiB7XG4gICAgICBjb25zdCBpZHMgPSBwYXlsb2FkLm1hcChkYXRhID0+IGRhdGEuaWQpO1xuICAgICAgY29uc3QgZGF0YSA9IF8ubWFwS2V5cyhwYXlsb2FkLCAnaWQnKSBhcyBDeWNsZXNEYXRhO1xuXG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgc3RhdGUsIHsgc3RhdHVzOiBmYWxzZSwgY291bnQ6IGlkcy5sZW5ndGgsIGlkcywgZGF0YSB9KTtcbiAgICB9XG5cbiAgICBkZWZhdWx0OiByZXR1cm4gc3RhdGU7XG4gIH1cbn07XG5cblxuLy8gU2VsZWN0b3JzXG5leHBvcnQgZnVuY3Rpb24gZ2V0SWRzKCkge1xuICByZXR1cm4gKGRpYXJ5JDogT2JzZXJ2YWJsZTxDeWNsZXNTdGF0ZT4pID0+IGRpYXJ5JC5tYXAodCA9PiB0LmlkcykuZmlsdGVyKGlkcyA9PiAhIWlkcyk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0YShpZHMpIHtcbiAgcmV0dXJuIChkaWFyeSQ6IE9ic2VydmFibGU8Q3ljbGVzU3RhdGU+KSA9PiBkaWFyeSRcbiAgICAubWFwKHQgPT4gdC5kYXRhKVxuICAgIC5maWx0ZXIoZGF0YSA9PiBkYXRhICE9PSBudWxsKVxuICAgIC5tYXAoZGF0YSA9PiBpZHMubWFwKGlkID0+IGRhdGFbaWRdKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VsZWN0ZWRJZCgpIHtcbiAgcmV0dXJuIChkaWFyeSQ6IE9ic2VydmFibGU8Q3ljbGVzU3RhdGU+KSA9PiBkaWFyeSQubWFwKHQgPT4gdC5zZWxlY3RlZCkuZmlsdGVyKHMgPT4gISFzLmxlbmd0aCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VsZWN0ZWREYXRlKCkge1xuICByZXR1cm4gKGRpYXJ5JDogT2JzZXJ2YWJsZTxDeWNsZXNTdGF0ZT4pID0+IGRpYXJ5JC5tYXAodCA9PiB0LmRhdGUpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlbGVjdGVkKCkge1xuICByZXR1cm4gKGRpYXJ5JDogT2JzZXJ2YWJsZTxDeWNsZXNTdGF0ZT4pID0+IGRpYXJ5JC5maWx0ZXIocyA9PiAhIXMuaWRzLmxlbmd0aCkubWFwKHQgPT4gdC5kYXRhW3Quc2VsZWN0ZWRdKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb3VudCgpIHtcbiAgcmV0dXJuIChkaWFyeSQ6IE9ic2VydmFibGU8Q3ljbGVzU3RhdGU+KSA9PiBkaWFyeSQubWFwKHQgPT4gdC5jb3VudCk7XG59XG4iXX0=